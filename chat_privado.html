<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Rantikuy Empire - Business OS V10 SUPREMACY</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --p-green: #10b981;
            --p-vibrant: #22c55e;
            --p-gold: #f59e0b;
            --p-sky: #0ea5e9;
            --p-light: #f8fafc;
            --p-white: #ffffff;
            --p-dark: #0f172a;
            --p-slate: #64748b;
            --p-red: #ef4444;
            --shadow-titan: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Plus Jakarta Sans', sans-serif; scrollbar-width: none; }
        *::-webkit-scrollbar { display: none; }

        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: var(--p-dark); overflow: hidden; }

        .app-shell { display: flex; width: 200%; height: 100%; transition: transform 0.8s cubic-bezier(0.85, 0, 0.15, 1); }
        .view-is-chat { transform: translateX(-50%); }

        .screen { width: 50%; height: 100%; display: flex; flex-direction: column; background: var(--p-white); position: relative; overflow: hidden; }

        /* HEADER SUPREMACY */
        .premium-header { 
            padding: 25px 30px; 
            background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
            border-bottom: 2px solid #ecfdf5;
            display: flex; justify-content: space-between; align-items: center; 
            z-index: 100;
        }
        .header-info h1 { margin: 0; font-size: 28px; font-weight: 800; letter-spacing: -1.5px; color: var(--p-dark); cursor: pointer; }
        .header-info h1 span { color: var(--p-green); }
        .header-info p { margin: 0; font-size: 10px; font-weight: 800; color: var(--p-slate); text-transform: uppercase; letter-spacing: 2px; }

        /* BANDEJA DE NEGOCIOS */
        .scroll-list { flex: 1; overflow-y: auto; padding: 20px; background: #fcfdfc; }
        .chat-card { 
            background: white; padding: 22px; border-radius: 35px; 
            display: flex; align-items: center; gap: 20px; margin-bottom: 18px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #f1f5f9;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .chat-card:active { transform: scale(0.94); background: #f0fdf4; }
        
        .avatar-frame { 
            width: 75px; height: 75px; border-radius: 28px; 
            background: linear-gradient(135deg, var(--p-green), var(--p-sky));
            display: flex; align-items: center; justify-content: center; 
            color: white; font-weight: 800; font-size: 28px; 
            box-shadow: 0 12px 24px rgba(16, 185, 129, 0.25); position: relative;
        }
        .online-status { 
            position: absolute; bottom: -2px; right: -2px; width: 22px; height: 22px; 
            background: #22c55e; border: 4px solid #fff; border-radius: 50%;
        }

        /* CHAT VIEW - MERCADO DE HUANTA */
        .chat-view { background: #e5ddd5 url('https://www.transparenttextures.com/patterns/graphy.png'); }
        .chat-top-nav { 
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px);
            padding: 15px 20px; display: flex; align-items: center; gap: 15px; 
            border-bottom: 1px solid #e2e8f0; z-index: 100;
        }

        /* INFO DEL VENDEDOR (PANEL DESPLEGABLE) */
        .seller-stats {
            background: white; margin: 10px 15px; border-radius: 30px; 
            padding: 20px; box-shadow: var(--shadow-titan);
            display: none; animation: slideDown 0.4s ease;
        }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .stat-box { background: #f8fafc; padding: 12px; border-radius: 20px; text-align: center; border: 1px solid #eee; }
        .stat-box b { display: block; font-size: 16px; color: var(--p-dark); }
        .stat-box span { font-size: 9px; color: var(--p-slate); font-weight: 800; }

        /* WIDGET DE PRODUCTO Y DELIVERY */
        .deal-widget { 
            margin: 10px 15px; padding: 18px; background: white; border-radius: 30px; 
            display: flex; align-items: center; gap: 15px; 
            border-left: 6px solid var(--p-gold); box-shadow: 0 15px 35px rgba(0,0,0,0.05);
        }
        .delivery-stepper {
            display: flex; justify-content: space-between; padding: 10px 20px;
            background: #f1f5f9; border-radius: 20px; margin: 0 15px 10px; font-size: 10px; font-weight: 800;
        }

        /* BURBUJAS DE CHAT */
        .chat-flow { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 18px; }
        .msg { 
            max-width: 82%; padding: 16px 20px; border-radius: 28px; 
            font-size: 15px; line-height: 1.6; position: relative; 
            animation: msgFade 0.4s ease-out;
        }
        @keyframes msgFade { from { opacity: 0; transform: translateY(20px); } }

        .m-me { align-self: flex-end; background: var(--p-green); color: white; border-bottom-right-radius: 5px; }
        .m-them { align-self: flex-start; background: white; color: var(--p-dark); border-bottom-left-radius: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }

        /* TARJETAS ESPECIALES */
        .invoice-card { background: var(--p-dark); color: white; padding: 20px; border-radius: 25px; min-width: 250px; }
        .map-card { background: #fff; padding: 10px; border-radius: 25px; border: 2px solid var(--p-green); }

        /* BOTONERA DE ACCI√ìN R√ÅPIDA */
        .quick-actions { display: flex; gap: 10px; overflow-x: auto; padding: 5px 15px; margin-bottom: 5px; }
        .action-btn { 
            background: white; border: 1px solid #e2e8f0; padding: 12px 22px; border-radius: 25px; 
            font-size: 12px; font-weight: 800; color: var(--p-dark); white-space: nowrap;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }

        /* BARRA DE ENTRADA PRO */
        .input-shelf { background: white; padding: 15px 20px calc(25px + var(--safe-bottom)); border-top: 1px solid #eee; }
        .input-bar { display: flex; align-items: center; gap: 12px; }
        .input-box-wrapper { 
            flex: 1; background: #f1f5f9; border-radius: 40px; padding: 5px 20px; 
            display: flex; align-items: center; border: 1px solid transparent; transition: 0.3s;
        }
        .input-box-wrapper:focus-within { border-color: var(--p-green); background: white; box-shadow: 0 0 0 4px rgba(16,185,129,0.1); }
        .input-box-wrapper input { flex: 1; border: none; background: transparent; padding: 14px 0; outline: none; font-size: 16px; font-weight: 500; }
        
        .round-btn { width: 55px; height: 55px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
        .btn-send { background: var(--p-dark); color: white; font-size: 22px; box-shadow: 0 10px 25px rgba(15,23,42,0.3); }
        .btn-send:active { transform: scale(0.9); }

        /* MODALES */
        .empire-modal {
            position: fixed; top:0; left:0; width:100%; height:100%; 
            background: rgba(15,23,42,0.9); z-index: 1000; display: none;
            justify-content: center; align-items: center; padding: 20px; backdrop-filter: blur(5px);
        }
        .modal-body { background: white; width: 100%; max-width: 420px; border-radius: 40px; padding: 30px; position: relative; }

        /* ADMIN CONSOLE */
        #empireConsole {
            position: fixed; top:0; left:0; width:100%; height:100%; background: #000; color: #0f0;
            z-index: 9999; padding: 40px; font-family: monospace; display: none; overflow-y: auto;
        }
    </style>
</head>
<body>

<div id="empireConsole">
    <h2>> RANTIKUY_EMPIRE_V10_SUPREMACY</h2>
    <p>> Usuario: ADMINISTRADOR_SUPREMO</p>
    <p>> Nodo: HUANTA_CITY_OFFICE</p>
    <hr>
    <div id="consoleLog"></div>
    <button onclick="closeConsole()" style="background:#0f0; color:#000; border:none; padding:15px; margin-top:20px; font-weight:bold; cursor:pointer;">CERRAR_SESION</button>
</div>

<div class="app-shell" id="appShell">
    
    <div class="screen">
        <header class="premium-header">
            <div class="header-info">
                <h1 onclick="handleAdminTaps()">Rantikuy<span>.Empire</span></h1>
                <p>Imperio Comercial V10</p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 18px; font-weight: 800;">S/ 5,840.20</div>
                <div style="font-size: 9px; color: var(--p-green); font-weight: 800;">BALANCE COMERCIAL</div>
            </div>
        </header>
        
        <div style="padding: 20px 30px; display: flex; justify-content: space-between; align-items: center;">
            <b style="font-size: 13px; color: var(--p-slate);">NEGOCIACIONES ACTIVAS</b>
            <span style="background: var(--p-red); color: white; padding: 4px 10px; border-radius: 10px; font-size: 10px; font-weight: 800;">3 URGENTES</span>
        </div>

        <div class="scroll-list" id="inbox"></div>

        <nav style="padding: 20px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around;">
            <button class="round-btn" style="background:none; font-size:24px;">üè¢</button>
            <button class="round-btn" style="background:var(--p-green); color:white; font-size:24px;">üí¨</button>
            <button class="round-btn" style="background:none; font-size:24px;">üìà</button>
            <button class="round-btn" style="background:none; font-size:24px;">‚öôÔ∏è</button>
        </nav>
    </div>

    <div class="screen chat-view">
        <nav class="chat-top-nav" onclick="toggleSellerStats()">
            <button onclick="event.stopPropagation(); goToInbox()" style="border:none; background:none; font-size:24px;">‚ùÆ</button>
            <div class="avatar-frame" id="chatAvatar" style="width:45px; height:45px; font-size:18px;">?</div>
            <div style="flex:1">
                <b id="chatName" style="font-size:18px;">Merchant</b>
                <div style="display:flex; align-items:center; gap:5px;">
                    <span style="color:var(--p-vibrant); font-size:10px; font-weight:800;">‚óè EN L√çNEA / VERIFICADO</span>
                </div>
            </div>
            <button class="round-btn" style="width:40px; height:40px; background:#f1f5f9; font-size:18px;">üõ°Ô∏è</button>
        </nav>

        <div class="seller-stats" id="sellerPanel">
            <h3 style="margin:0; font-size:18px;">Nivel de Confianza</h3>
            <div class="stat-grid">
                <div class="stat-box"><b>4.9 ‚≠ê</b><span>RATING</span></div>
                <div class="stat-box"><b>+500</b><span>VENTAS</span></div>
                <div class="stat-box"><b>100%</b><span>LEGAL</span></div>
            </div>
            <p style="font-size:11px; color:var(--p-slate); margin-top:15px; text-align:center;">üìç Operando desde: Huanta, Ayacucho</p>
        </div>

        <div class="deal-widget">
            <div style="width:50px; height:50px; background:var(--p-light); border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:24px;">üíé</div>
            <div style="flex:1">
                <b id="dealTitle">Cargamento Pro</b><br>
                <span style="color:var(--p-green); font-weight:800;">S/ <span id="dealPrice">0.00</span></span>
            </div>
            <button onclick="showMap()" style="background:var(--p-dark); color:white; border:none; padding:10px 15px; border-radius:15px; font-weight:800; font-size:11px;">MAPA</button>
        </div>

        <div class="delivery-stepper">
            <span style="color:var(--p-green)">‚óè PAGADO</span>
            <span style="color:var(--p-gold)">‚óã EN CAMINO</span>
            <span style="opacity:0.3">‚óã ENTREGADO</span>
        </div>

        <div class="chat-flow" id="msgFlow"></div>

        <div class="quick-actions">
            <button class="action-btn" onclick="openOfferModal()">üìâ REGATEAR</button>
            <button class="action-btn" onclick="generateInvoice()">üìë GENERAR FACTURA</button>
            <button class="action-btn" onclick="sendQuickMsg('¬°Trato hecho! ü§ù')">ü§ù CERRAR TRATO</button>
            <button class="action-btn" onclick="toggleStickers()">‚ú® STICKERS</button>
        </div>

        <div class="input-shelf">
            <div id="stickerDrawer" style="display:none; grid-template-columns:repeat(5,1fr); gap:15px; padding:15px; background:#f8fafc; border-radius:25px; margin-bottom:10px;">
                <div onclick="sendSticker('ü§ù')" style="font-size:30px; text-align:center; cursor:pointer;">ü§ù</div>
                <div onclick="sendSticker('üí∞')" style="font-size:30px; text-align:center; cursor:pointer;">üí∞</div>
                <div onclick="sendSticker('üî•')" style="font-size:30px; text-align:center; cursor:pointer;">üî•</div>
                <div onclick="sendSticker('üíé')" style="font-size:30px; text-align:center; cursor:pointer;">üíé</div>
                <div onclick="sendSticker('‚úÖ')" style="font-size:30px; text-align:center; cursor:pointer;">‚úÖ</div>
            </div>
            <div class="input-bar">
                <button class="round-btn" style="background:#f1f5f9;" onclick="pickFile()">üìé</button>
                <div class="input-box-wrapper">
                    <input type="text" id="userInput" placeholder="Escriba t√©rminos comerciales...">
                </div>
                <button class="round-btn btn-send" onclick="processMessage()">üöÄ</button>
            </div>
        </div>
    </div>
</div>

<div class="empire-modal" id="mapModal">
    <div class="modal-body">
        <h2 style="margin-top:0;">Punto de Encuentro</h2>
        <div style="width:100%; height:200px; background:#e2e8f0; border-radius:25px; display:flex; align-items:center; justify-content:center; flex-direction:column; position:relative; overflow:hidden;">
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:40px; z-index:2;">üìç</div>
            <div style="padding:20px; text-align:center;">
                <b id="locationName">Plaza de Armas - Huanta</b><br>
                <small>Referencia: Frente al BCP</small>
            </div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;">
            <button onclick="changeLocation('Mercado Central')" style="padding:10px; border-radius:15px; border:1px solid #ddd; background:white; font-weight:800;">MERCADO</button>
            <button onclick="changeLocation('Terminal Terrestre')" style="padding:10px; border-radius:15px; border:1px solid #ddd; background:white; font-weight:800;">TERMINAL</button>
        </div>
        <button onclick="confirmLocation()" style="width:100%; background:var(--p-green); color:white; border:none; padding:18px; border-radius:20px; margin-top:15px; font-weight:800;">CONFIRMAR PUNTO</button>
        <button onclick="closeModal('mapModal')" style="width:100%; background:none; border:none; padding:10px; color:var(--p-slate); font-weight:800;">CANCELAR</button>
    </div>
</div>

<div class="empire-modal" id="offerModal">
    <div class="modal-body">
        <h2 style="margin:0;">Propuesta Econ√≥mica</h2>
        <p style="color:var(--p-slate); font-size:13px;">Ingresa tu contraoferta para este activo.</p>
        <div style="background:#f1f5f9; padding:25px; border-radius:30px; margin:20px 0; border:2px solid #e2e8f0;">
            <span style="font-weight:900; color:var(--p-green); font-size:20px;">S/ </span>
            <input type="number" id="offerInput" style="background:none; border:none; font-size:35px; font-weight:900; width:80%; outline:none;" placeholder="0.00">
        </div>
        <button onclick="submitOffer()" style="width:100%; background:var(--p-dark); color:white; border:none; padding:18px; border-radius:20px; font-weight:800;">ENVIAR OFERTA</button>
        <button onclick="closeModal('offerModal')" style="width:100%; background:none; border:none; padding:15px; color:var(--p-slate); font-weight:800;">CERRAR</button>
    </div>
</div>

<script>
    const APP_USER = localStorage.getItem('rantiy_user') || "Lider_Supremo";
    let ACTIVE_CHAT = "";
    let ADMIN_TAPS = 0;
    const DB_KEY = 'empire_v10_db';

    function boot() {
        renderInbox();
        document.getElementById('userInput').onkeypress = e => { if(e.key === 'Enter') processMessage(); };
        const last = localStorage.getItem('last_chat_partner');
        if(last) { localStorage.removeItem('last_chat_partner'); openChat(last); }
        
        setInterval(() => { renderInbox(); if(ACTIVE_CHAT) renderMessages(); }, 2000);
    }

    // ADMIN TRIGGER (7 TAPS EN EL TITULO)
    function handleAdminTaps() {
        ADMIN_TAPS++;
        if(ADMIN_TAPS >= 7) {
            document.getElementById('empireConsole').style.display = 'block';
            const db = localStorage.getItem(DB_KEY);
            document.getElementById('consoleLog').innerHTML = `<pre>${JSON.stringify(JSON.parse(db || '{}'), null, 2)}</pre>`;
            ADMIN_TAPS = 0;
        }
        setTimeout(() => { if(ADMIN_TAPS < 7) ADMIN_TAPS = 0; }, 3000);
    }
    function closeConsole() { document.getElementById('empireConsole').style.display = 'none'; }

    function renderInbox() {
        const inbox = document.getElementById('inbox');
        const db = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
        const chats = Object.keys(db).filter(k => k.includes(APP_USER));
        
        if(chats.length === 0) {
            inbox.innerHTML = `<div style="text-align:center; padding:80px; opacity:0.3;"><h3>üè¢</h3><p>Buscando socios...</p></div>`;
            return;
        }

        inbox.innerHTML = chats.map(k => {
            const partner = k.replace(APP_USER, "").replace("_", "");
            const lastMsg = db[k][db[k].length - 1];
            return `
                <div class="chat-card" onclick="openChat('${partner}')">
                    <div class="avatar-frame">${partner[0].toUpperCase()}<div class="online-status"></div></div>
                    <div style="flex:1">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                            <b style="font-size:18px;">${partner}</b>
                            <span style="font-size:11px; font-weight:800; color:var(--p-slate);">${lastMsg.h}</span>
                        </div>
                        <p style="margin:0; font-size:14px; color:var(--p-slate); overflow:hidden; white-space:nowrap; text-overflow:ellipsis;">
                            ${lastMsg.u === APP_USER ? '<span>‚úì</span> ' : ''}${lastMsg.t.substring(0,35)}
                        </p>
                    </div>
                </div>
            `;
        }).join('');
    }

    function openChat(name) {
        ACTIVE_CHAT = name;
        document.getElementById('chatName').innerText = name;
        document.getElementById('chatAvatar').innerText = name[0].toUpperCase();
        document.getElementById('appShell').classList.add('view-is-chat');
        document.getElementById('dealPrice').innerText = (100 + Math.random() * 900).toFixed(2);
        renderMessages();
    }

    function goToInbox() {
        ACTIVE_CHAT = "";
        document.getElementById('appShell').classList.remove('view-is-chat');
    }

    function renderMessages() {
        const flow = document.getElementById('msgFlow');
        const db = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
        const key = [APP_USER, ACTIVE_CHAT].sort().join('_');
        const msgs = db[key] || [];

        const html = msgs.map(m => {
            let body = m.t;
            if(m.type === 'offer') body = `<div style="border:2px dashed #f59e0b; padding:15px; border-radius:20px;"><span>OFERTA RECIBIDA</span><br><b style="font-size:24px;">S/ ${m.t}</b></div>`;
            if(m.type === 'invoice') body = `<div class="invoice-card"><h3>Rantikuy Invoice</h3><hr><p>Items: Cargamento Pro<br>Total: S/ ${m.t}<br>Tax: Incluido</p><div style="background:white; padding:10px; width:60px; height:60px; margin:auto;">QR</div></div>`;
            if(m.type === 'location') body = `<div class="map-card">üìç <b>Punto de Encuentro:</b><br>${m.t}</div>`;
            if(m.type === 'sticker') body = `<div style="font-size:80px; text-align:center;">${m.t}</div>`;
            if(m.type === 'img') body = `<img src="${m.t}" style="width:100%; border-radius:20px;">`;

            return `
                <div class="msg ${m.u === APP_USER ? 'm-me' : 'm-them'}">
                    ${body}
                    <div style="font-size:9px; opacity:0.6; text-align:right; margin-top:8px;">${m.h} ${m.u === APP_USER ? '‚úì‚úì' : ''}</div>
                </div>
            `;
        }).join('');

        if(flow.innerHTML !== html) {
            flow.innerHTML = html;
            flow.scrollTop = flow.scrollHeight;
        }
    }

    function processMessage() {
        const input = document.getElementById('userInput');
        if(!input.value.trim()) return;
        saveMsg(input.value, 'text');
        input.value = "";
    }

    function saveMsg(txt, type) {
        let db = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
        const key = [APP_USER, ACTIVE_CHAT].sort().join('_');
        if(!db[key]) db[key] = [];
        db[key].push({
            u: APP_USER, t: txt, type: type,
            h: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
        });
        localStorage.setItem(DB_KEY, JSON.stringify(db));
        renderMessages();
    }

    // FUNCIONES PRO
    function toggleSellerStats() {
        const p = document.getElementById('sellerPanel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function openOfferModal() { document.getElementById('offerModal').style.display = 'flex'; }
    function submitOffer() {
        const val = document.getElementById('offerInput').value;
        if(!val) return;
        saveMsg(val, 'offer');
        closeModal('offerModal');
        document.getElementById('offerInput').value = "";
    }

    function generateInvoice() {
        const price = document.getElementById('dealPrice').innerText;
        saveMsg(price, 'invoice');
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.8 }, colors: ['#fbbf24', '#22c55e'] });
    }

    function showMap() { document.getElementById('mapModal').style.display = 'flex'; }
    function changeLocation(loc) { document.getElementById('locationName').innerText = loc; }
    function confirmLocation() {
        const loc = document.getElementById('locationName').innerText;
        saveMsg(loc, 'location');
        closeModal('mapModal');
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function sendQuickMsg(t) { saveMsg(t, 'text'); if(t.includes('ü§ù')) confetti(); }
    function toggleStickers() {
        const d = document.getElementById('stickerDrawer');
        d.style.display = d.style.display === 'grid' ? 'none' : 'grid';
    }
    function sendSticker(s) { saveMsg(s, 'sticker'); toggleStickers(); }

    function pickFile() {
        let i = document.createElement('input'); i.type='file';
        i.onchange = e => {
            const f = e.target.files[0];
            const r = new FileReader();
            r.onload = ev => saveMsg(ev.target.result, f.type.includes('image') ? 'img' : 'text');
            r.readAsDataURL(f);
        };
        i.click();
    }

    window.onload = boot;
</script>
</body>
</html>
