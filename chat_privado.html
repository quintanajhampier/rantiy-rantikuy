<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>QUINTANA EMPIRE - ULTIMATE COMMAND CENTER</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --p-black: #020202;
            --p-dark: #0a0a0a;
            --p-gray: #111111;
            --gold: #d4af37;
            --gold-bright: #ffea94;
            --gold-grad: linear-gradient(135deg, #8a6d3b 0%, #d4af37 50%, #ffea94 100%);
            --neon-gold: 0 0 15px rgba(212, 175, 55, 0.3);
            --safe-top: env(safe-area-inset-top);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100%; 
            background: var(--p-black); color: #e0e0e0; 
            font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; position: fixed; 
        }

        /* ESTRUCTURA NAVEGACI√ìN CINEM√ÅTICA */
        .app-shell { display: flex; width: 600%; height: 100%; transition: transform 0.7s cubic-bezier(0.85, 0, 0.15, 1); }
        .screen { width: 16.6666%; height: 100%; display: flex; flex-direction: column; position: relative; background: var(--p-black); }

        /* CABECERA PRESTIGE */
        .header { 
            padding: 20px; background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(20px);
            display: flex; justify-content: space-between; align-items: center;
            padding-top: calc(25px + var(--safe-top)); border-bottom: 1px solid rgba(212, 175, 55, 0.4); z-index: 1000;
        }
        .brand { display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .brand-icon { 
            width: 45px; height: 45px; background: var(--gold-grad); border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; font-weight: 900; color: black; font-size: 24px;
            box-shadow: var(--neon-gold); transform: rotate(-5deg);
        }
        .brand-text { font-weight: 800; font-size: 22px; letter-spacing: 2px; text-transform: uppercase; color: white; }
        .brand-text span { color: var(--gold); font-weight: 300; }

        /* LISTA DE CHATS ESTILO ELITE */
        .scroller { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; scroll-behavior: smooth; }
        .search-bar { 
            background: var(--p-gray); border: 1px solid #222; border-radius: 15px; 
            padding: 12px 20px; margin-bottom: 20px; width: 100%; color: white; font-size: 14px;
        }
        
        .card-elite {
            background: linear-gradient(145deg, #111, #080808); border-radius: 24px; padding: 18px; 
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.03); display: flex; 
            align-items: center; gap: 18px; transition: 0.4s; cursor: pointer;
        }
        .card-elite:active { transform: scale(0.96); background: #1a1a1a; }
        .card-elite.active { border-left: 5px solid var(--gold); }

        .avatar-frame {
            width: 65px; height: 65px; border-radius: 20px; padding: 2px; background: var(--gold-grad);
        }
        .avatar-img {
            width: 100%; height: 100%; border-radius: 18px; background: var(--p-dark);
            display: flex; align-items: center; justify-content: center; font-weight: 800; color: var(--gold); font-size: 24px;
        }

        /* DASHBOARD KPIS */
        .grid-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .stat-box { 
            background: var(--p-gray); padding: 20px; border-radius: 25px; border: 1px solid rgba(212,175,55,0.1);
            position: relative; overflow: hidden;
        }
        .stat-box::after { content: ''; position: absolute; top:0; right:0; width:40px; height:40px; background: var(--gold); opacity:0.05; border-radius: 0 0 0 100%; }
        .stat-label { font-size: 11px; color: var(--gold); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        .stat-val { font-size: 22px; font-weight: 800; margin-top: 8px; color: white; }

        /* BOTONES SUPREMOS */
        .btn-gold {
            background: var(--gold-grad); color: black; border: none; padding: 20px; border-radius: 20px;
            width: 100%; font-weight: 800; font-size: 15px; text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.2); margin-top: 15px; cursor: pointer;
        }

        /* CHAT SYSTEM */
        #chat-window { position: fixed; inset: 0; background: var(--p-black); z-index: 2000; display: none; flex-direction: column; }
        .chat-header { padding: 15px 20px; background: var(--p-dark); border-bottom: 1px solid var(--gold); display: flex; align-items: center; gap: 15px; }
        .chat-view { 
            flex: 1; overflow-y: auto; padding: 25px; 
            background-image: radial-gradient(circle at 2px 2px, #1a1a1a 1px, transparent 0); background-size: 30px 30px;
            display: flex; flex-direction: column; gap: 12px;
        }
        .bbl { max-width: 80%; padding: 14px 18px; border-radius: 22px; font-size: 15px; line-height: 1.5; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .bbl.me { align-self: flex-end; background: var(--gold-grad); color: black; border-bottom-right-radius: 4px; font-weight: 600; }
        .bbl.them { align-self: flex-start; background: var(--p-gray); color: white; border-bottom-left-radius: 4px; border: 1px solid #333; }
        
        .chat-ctrl { 
            padding: 20px; background: var(--p-dark); display: flex; align-items: center; gap: 12px;
            padding-bottom: calc(20px + var(--safe-top)); border-top: 1px solid #222;
        }
        .chat-input { flex: 1; background: #1a1a1a; border: 1px solid #333; border-radius: 30px; padding: 15px 25px; color: white; font-size: 16px; }

        /* MEN√ö MAESTRO */
        .float-menu {
            position: absolute; top: 90px; right: 20px; width: 280px; background: var(--p-dark);
            border: 1px solid var(--gold); border-radius: 25px; display: none; flex-direction: column; z-index: 5000;
            overflow: hidden; box-shadow: 0 30px 60px rgba(0,0,0,0.9);
        }
        .menu-btn { padding: 20px 25px; color: white; display: flex; align-items: center; gap: 15px; font-weight: 600; border-bottom: 1px solid #1a1a1a; transition: 0.3s; }
        .menu-btn i { color: var(--gold); font-size: 20px; font-style: normal; }
        .menu-btn:active { background: var(--gold); color: black; }

        /* MODALES */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); z-index: 6000; display: none; align-items: center; padding: 20px; }
        .modal { 
            background: var(--p-dark); width: 100%; border-radius: 30px; padding: 35px; border: 1px solid var(--gold);
            box-shadow: 0 0 50px rgba(212,175,55,0.1); transform: translateY(0);
        }
        .f-label { display: block; color: var(--gold); font-size: 12px; font-weight: 800; margin: 15px 0 8px; text-transform: uppercase; }
        .f-input { width: 100%; background: #151515; border: 1px solid #333; padding: 18px; border-radius: 18px; color: white; font-size: 16px; }

        /* TOAST */
        .toast-wrap { position: fixed; bottom: 40px; width: 100%; display: flex; justify-content: center; z-index: 9999; pointer-events: none; }
        .toast { background: var(--gold-grad); color: black; padding: 15px 40px; border-radius: 50px; font-weight: 800; letter-spacing: 1px; box-shadow: 0 15px 40px rgba(0,0,0,0.6); animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        @keyframes bounceIn { from { transform: scale(0); } to { transform: scale(1); } }
    </style>
</head>
<body>

<div class="toast-wrap" id="t-wrap"></div>

<div class="float-menu" id="fMenu">
    <div class="menu-btn" onclick="nav(1); hMenu()"><i>üí¨</i> Mando de Red</div>
    <div class="menu-btn" onclick="nav(2); hMenu()"><i>üì¶</i> Almac√©n Quintana</div>
    <div class="menu-btn" onclick="nav(3); hMenu()"><i>ü§ù</i> Socios Estrat√©gicos</div>
    <div class="menu-btn" onclick="nav(4); hMenu()"><i>üöö</i> Rutas VRAEM</div>
    <div class="menu-btn" onclick="nav(5); hMenu()"><i>üí∞</i> B√≥veda & Caja</div>
    <div class="menu-btn" onclick="nav(6); hMenu()"><i>üëë</i> Panel Supremo</div>
</div>

<div class="app-shell" id="aShell">
    
    <div class="screen">
        <header class="header">
            <div class="brand" onclick="adminLogic()">
                <div class="brand-icon">Q</div>
                <div class="brand-text">QUINTANA <span>EMPIRE</span></div>
            </div>
            <button onclick="tMenu()" style="background:none; border:none; color:var(--gold); font-size:32px;">‚ãÆ</button>
        </header>
        <div class="scroller">
            <input type="text" class="search-bar" placeholder="Buscar socio o instrucci√≥n..." onkeyup="searchChat(this.value)">
            <div id="chat-list-ui"></div>
        </div>
    </div>

    <div class="screen">
        <header class="header">
            <button onclick="nav(1)" style="background:none; border:none; color:white; font-size:24px;">‚Üê</button>
            <b class="brand-text">B√ìVEDA <span>STOCK</span></b>
            <span></span>
        </header>
        <div class="scroller">
            <div class="grid-stats">
                <div class="stat-box"><div class="stat-label">Valorizaci√≥n</div><div class="stat-val" id="stk-val">S/ 0</div></div>
                <div class="stat-box"><div class="stat-label">Variedad</div><div class="stat-val" id="stk-qty">0</div></div>
            </div>
            <div id="stk-render"></div>
            <button class="btn-gold" onclick="oMod('stock')">Ôºã Ingresar Mercanc√≠a</button>
        </div>
    </div>

    <div class="screen">
        <header class="header">
            <button onclick="nav(1)" style="background:none; border:none; color:white; font-size:24px;">‚Üê</button>
            <b class="brand-text">SOCIOS <span>ELITE</span></b>
            <span></span>
        </header>
        <div class="scroller">
            <div id="ptr-render"></div>
            <button class="btn-gold" onclick="oMod('partner')">ü§ù Vincular Aliado</button>
        </div>
    </div>

    <div class="screen">
        <header class="header">
            <button onclick="nav(1)" style="background:none; border:none; color:white; font-size:24px;">‚Üê</button>
            <b class="brand-text">RUTAS <span>MAESTRAS</span></b>
            <span></span>
        </header>
        <div class="scroller">
            <div id="rte-render"></div>
            <button class="btn-gold" onclick="oMod('route')">üöö Nueva Hoja de Ruta</button>
        </div>
    </div>

    <div class="screen">
        <header class="header">
            <button onclick="nav(1)" style="background:none; border:none; color:white; font-size:24px;">‚Üê</button>
            <b class="brand-text">ESTADO <span>RESULTADOS</span></b>
            <span></span>
        </header>
        <div class="scroller">
            <div class="stat-box" style="margin-bottom:25px; padding:35px; border-left: 5px solid #22c55e;">
                <div class="stat-label">Liquidez Real Quintana</div>
                <div class="stat-val" style="font-size:48px; color:#22c55e;" id="ui-csh">S/ 0.00</div>
            </div>
            <h3 style="color:var(--gold); letter-spacing:2px;">AUDITOR√çA DE MOVIMIENTOS</h3>
            <div id="log-render"></div>
        </div>
    </div>

    <div class="screen">
        <header class="header"><b class="brand-text">QUINTANA <span>OS v6</span></b></header>
        <div class="scroller" style="text-align:center;">
            <div class="avatar-frame" style="margin: 40px auto 20px; width:120px; height:120px; border-radius:40px;">
                <div class="avatar-img" style="font-size:50px; border-radius:38px;">Q</div>
            </div>
            <h2 style="margin:0;">Quintana Master</h2>
            <p style="color:var(--gold); font-weight:700;">Imperio Huanta - Ayacucho</p>
            <br><br>
            <button class="btn-gold" onclick="exp()">üìä Descargar Reporte de Inteligencia</button>
            <button class="btn-gold" onclick="cld()" style="background:none; border:1px solid var(--gold); color:white;">‚òÅÔ∏è Respaldo Cifrado Activo</button>
            <button class="btn-gold" onclick="rst()" style="background:#ff4444; border:none; color:white; margin-top:50px;">üß® Auto-Destruir Base de Datos</button>
        </div>
    </div>

</div>

<div id="chat-window">
    <div class="chat-header">
        <button onclick="cChat()" style="background:none; border:none; color:white; font-size:28px;">‚Üê</button>
        <div class="avatar-frame" style="width:50px; height:50px; border-radius:15px;"><div class="avatar-img" id="c-av" style="font-size:18px; border-radius:13px;">S</div></div>
        <div style="flex:1">
            <b id="c-nm" style="font-size:18px;">Socio</b><br>
            <small style="color:#22c55e; font-weight:700;">‚óè DISPONIBLE</small>
        </div>
        <div style="color:var(--gold); font-size:25px;">üìû &nbsp; ‚öôÔ∏è</div>
    </div>
    <div class="chat-view" id="c-box"></div>
    <div class="chat-ctrl">
        <button onclick="document.getElementById('fi').click()" style="background:none; border:none; color:var(--gold); font-size:30px;">‚äï</button>
        <input type="text" id="ci" class="chat-input" placeholder="Escribe instrucci√≥n al socio..." onkeypress="if(event.key==='Enter') sMsg()">
        <button onclick="sMsg()" style="background:var(--gold-grad); border:none; width:55px; height:55px; border-radius:50%; color:black; font-size:22px;">‚û§</button>
    </div>
    <input type="file" id="fi" style="display:none" onchange="hFil(this)">
</div>

<div class="overlay" id="ov" onclick="cMod()">
    <div class="modal" id="m-cnt" onclick="event.stopPropagation()"></div>
</div>

<script>
    // --- MOTOR DE DATOS QUINTANA ---
    let db = JSON.parse(localStorage.getItem('Q_EMPIRE_V6')) || {
        cash: 35000.00,
        stock: [
            { id: 1, name: 'Caf√© Pergamino Especial', price: 480.50, qty: 50, img: 'https://images.unsplash.com/photo-1559056199-641a0ac8b55e?w=300' }
        ],
        partners: [
            { id: 700, name: 'Socio Huanta Centro', phone: '967593948', last: 'Pedido en ruta Quintana', msgs: [] }
        ],
        routes: [{ id: 1, dst: 'Huanta -> Ayacucho', drv: 'Unidad 01', st: 'En Viaje' }],
        logs: [{ t: '09:00', m: 'QUINTANA OS SYSTEM ONLINE' }]
    };

    function save() { localStorage.setItem('Q_EMPIRE_V6', JSON.stringify(db)); rAll(); }

    // --- NAVEGACI√ìN CINEM√ÅTICA ---
    function nav(p) { document.getElementById('aShell').style.transform = `translateX(-${(p-1)*16.6666}%)`; }
    function tMenu() { const m = document.getElementById('fMenu'); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; }
    function hMenu() { document.getElementById('fMenu').style.display = 'none'; }

    // --- RENDERIZADO DE ALTO IMPACTO ---
    function rAll() {
        // Chats
        document.getElementById('chat-list-ui').innerHTML = db.partners.map(p => `
            <div class="card-elite" onclick="oChat(${p.id})">
                <div class="avatar-frame"><div class="avatar-img">${p.name[0]}</div></div>
                <div style="flex:1"><b>${p.name}</b><p>${p.last}</p></div>
                <div style="color:var(--gold); font-size:11px;">AHORA</div>
            </div>
        `).join('');

        // Stock & KPIs
        let totalVal = 0;
        document.getElementById('stk-render').innerHTML = db.stock.map(s => {
            totalVal += (s.price * s.qty);
            return `
                <div class="card-elite" style="border-right: 4px solid var(--gold)">
                    <img src="${s.img}" style="width:75px; height:75px; border-radius:15px; object-fit:cover;">
                    <div style="flex:1"><b>${s.name}</b><br><b style="color:var(--gold)">S/ ${s.price}</b> <small>| x${s.qty}</small></div>
                    <button onclick="sell(${s.id})" style="background:var(--gold); color:black; border:none; padding:12px; border-radius:12px; font-weight:900;">VENDER</button>
                </div>
            `;
        }).join('');
        document.getElementById('stk-val').innerText = `S/ ${totalVal.toLocaleString()}`;
        document.getElementById('stk-qty').innerText = db.stock.length;
        document.getElementById('ui-csh').innerText = `S/ ${db.cash.toFixed(2)}`;

        // Logs
        document.getElementById('log-render').innerHTML = db.logs.slice(-20).reverse().map(l => `
            <div style="padding:15px; border-bottom:1px solid #111; font-size:13px;">
                <b style="color:var(--gold)">[${l.t}]</b> ${l.m}
            </div>
        `).join('');

        // Rutas y Socios
        document.getElementById('ptr-render').innerHTML = db.partners.map(p => `<div class="card-elite"><b>${p.name}</b><br><small>${p.phone}</small></div>`).join('');
        document.getElementById('rte-render').innerHTML = db.routes.map(r => `<div class="card-elite"><b>${r.dst}</b><br><small>${r.drv} - ${r.st}</small></div>`).join('');
    }

    // --- CHAT SYSTEM ELITE ---
    let actId = null;
    function oChat(id) {
        actId = id; const p = db.partners.find(x => x.id === id);
        document.getElementById('c-nm').innerText = p.name;
        document.getElementById('c-av').innerText = p.name[0];
        document.getElementById('chat-window').style.display = 'flex';
        rMsgs();
    }
    function cChat() { document.getElementById('chat-window').style.display = 'none'; }

    function sMsg(t = null, ty = 'text') {
        const i = document.getElementById('ci'); const c = t || i.value; if(!c) return;
        const p = db.partners.find(x => x.id === actId);
        const tm = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        p.msgs.push({ u: 'me', t: c, tm: tm, ty: ty });
        p.last = ty === 'img' ? 'üì∑ Imagen recibida' : c;
        if(!t) i.value = ''; save(); rMsgs();
        setTimeout(() => {
            p.msgs.push({ u: 'them', t: 'Orden confirmada Master Quintana. Procediendo.', tm: tm, ty: 'text' });
            save(); rMsgs();
        }, 1200);
    }

    function rMsgs() {
        const p = db.partners.find(x => x.id === actId);
        const box = document.getElementById('c-box');
        box.innerHTML = p.msgs.map(m => `
            <div class="bbl ${m.u}">${m.ty==='img' ? `<img src="${m.t}" style="width:100%; border-radius:12px;">`: m.t}<div style="font-size:9px; opacity:0.5; text-align:right; margin-top:5px;">${m.tm}</div></div>
        `).join('');
        box.scrollTop = box.scrollHeight;
    }

    // --- MODALES DIN√ÅMICOS (ENTREVISTA INTELIGENTE) ---
    function oMod(m) {
        const c = document.getElementById('m-cnt');
        if(m === 'stock') {
            c.innerHTML = `
                <h2 style="color:var(--gold)">Nuevo Ingreso de Mercanc√≠a</h2>
                <label class="f-label">¬øQu√© producto estamos recibiendo?</label><input id="f1" class="f-input" placeholder="Nombre del producto">
                <label class="f-label">¬øPrecio de venta final (S/)?</label><input id="f2" class="f-input" type="number" placeholder="0.00">
                <label class="f-label">¬øCantidad que ingresa a b√≥veda?</label><input id="f3" class="f-input" type="number" placeholder="10">
                <button class="btn-gold" onclick="subMod('stock')">AUTORIZAR INGRESO</button>
            `;
        } else if(m === 'partner') {
            c.innerHTML = `
                <h2 style="color:var(--gold)">Vincular Nuevo Aliado</h2>
                <label class="f-label">Nombre o Raz√≥n Social</label><input id="f1" class="f-input" placeholder="Nombre">
                <label class="f-label">N√∫mero de Contacto Directo</label><input id="f2" class="f-input" placeholder="967...">
                <button class="btn-gold" onclick="subMod('partner')">VINCULAR AL IMPERIO</button>
            `;
        } else if(m === 'route') {
            c.innerHTML = `
                <h2 style="color:var(--gold)">Trazar Ruta de Despacho</h2>
                <label class="f-label">Destino (Ciudad/Mercado)</label><input id="f1" class="f-input" placeholder="Destino">
                <label class="f-label">Unidad / Chofer</label><input id="f2" class="f-input" placeholder="Responsable">
                <button class="btn-gold" onclick="subMod('route')">DESPACHAR UNIDAD</button>
            `;
        }
        document.getElementById('ov').style.display = 'flex';
    }
    function cMod() { document.getElementById('ov').style.display = 'none'; }

    function subMod(m) {
        const v1 = document.getElementById('f1').value, v2 = document.getElementById('f2').value;
        if(!v1 || !v2) return;
        if(m === 'stock') {
            const v3 = document.getElementById('f3').value;
            db.stock.push({ id: Date.now(), name: v1, price: parseFloat(v2), qty: parseInt(v3), img: 'https://via.placeholder.com/300/111/d4af37?text=QUINTANA+STOCK' });
            db.logs.push({ t: new Date().toLocaleTimeString(), m: `INGRESO: ${v1} x${v3}` });
        } else if(m === 'partner') {
            db.partners.push({ id: Date.now(), name: v1, phone: v2, last: 'Nuevo socio registrado', msgs: [] });
        } else if(m === 'route') {
            db.routes.push({ id: Date.now(), dst: v1, drv: v2, st: 'En Alistamiento' });
        }
        save(); cMod(); tst("SISTEMA ACTUALIZADO");
    }

    // --- L√ìGICA DE NEGOCIO ---
    function sell(id) {
        const s = db.stock.find(x => x.id === id);
        if(s.qty > 0) {
            s.qty--; db.cash += s.price;
            db.logs.push({ t: new Date().toLocaleTimeString(), m: `VENTA REALIZADA: ${s.name} (+S/ ${s.price})` });
            confetti(); tst("¬°S/ "+s.price+" INGRESADOS!"); save();
        }
    }

    function hFil(el) {
        const r = new FileReader(); r.onload = (e) => sMsg(e.target.result, 'img');
        r.readAsDataURL(el.files[0]);
    }

    function searchChat(v) {
        const cards = document.querySelectorAll('#chat-list-ui .card-elite');
        cards.forEach(c => {
            const txt = c.innerText.toLowerCase();
            c.style.display = txt.includes(v.toLowerCase()) ? 'flex' : 'none';
        });
    }

    function tst(t) {
        const w = document.getElementById('t-wrap');
        const e = document.createElement('div'); e.className = 'toast'; e.innerText = t;
        w.appendChild(e); setTimeout(() => e.remove(), 2500);
    }

    function adminLogic() {
        window.at = (window.at || 0) + 1;
        if(window.at >= 7) { confetti(); tst("MASTER ACCESS GRANTED"); }
    }

    function exp() {
        let txt = "REPORTE QUINTANA EMPIRE\n\n";
        db.logs.forEach(l => txt += `[${l.t}] ${l.m}\n`);
        const b = new Blob([txt], {type:'text/plain'});
        const u = URL.createObjectURL(b);
        const a = document.createElement('a'); a.href = u; a.download = 'Reporte_Elite.txt'; a.click();
    }

    function rst() { if(confirm("¬øCONFIRMA DESTRUCCI√ìN DE DATOS?")) { localStorage.clear(); location.reload(); } }

    window.onload = rAll;
</script>
</body>
</html>
