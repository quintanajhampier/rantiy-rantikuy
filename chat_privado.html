<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>rsnty y rantykuy</title>
    <style>
        :root {
            --emerald: #2ecc71;
            --dark-green: #1b5e20;
            --soft-white: #f8fafb;
            --sky-accent: #3498db;
            --pure-white: #ffffff;
            --glass-shadow: 0 10px 30px rgba(0,0,0,0.08);
            --deep-shadow: 12px 12px 24px #d1d9e6, -12px -12px 24px #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', -apple-system, sans-serif; }
        body { background: var(--soft-white); color: #2c3e50; height: 100vh; overflow: hidden; }

        /* HEADER PROFESIONAL */
        header {
            background: var(--pure-white); padding: 50px 20px 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 4px solid var(--dark-green);
        }
        .brand { display: flex; align-items: center; gap: 12px; }
        .logo-box { 
            width: 45px; height: 45px; background: var(--dark-green); border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 900; font-size: 18px; box-shadow: 0 4px 10px rgba(27,94,32,0.3);
        }
        .app-title { font-size: 20px; font-weight: 800; color: var(--dark-green); letter-spacing: -0.5px; }

        /* CONTENEDOR DE PANTALLAS */
        .viewport { display: flex; width: 200%; height: 100vh; transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1); }
        .screen { width: 50%; height: 100%; display: flex; flex-direction: column; padding: 20px; padding-bottom: 120px; overflow-y: auto; }

        /* CONTACTOS ESTILO WHATSAPP 3D */
        .card-3d {
            background: var(--pure-white); padding: 18px; border-radius: 22px; margin-bottom: 15px;
            display: flex; align-items: center; gap: 15px; box-shadow: var(--deep-shadow);
            border: 1px solid rgba(0,0,0,0.02); transition: 0.2s;
        }
        .card-3d:active { transform: translateY(4px) scale(0.98); box-shadow: 4px 4px 10px #d1d9e6; }
        .av-3d { 
            width: 55px; height: 55px; border-radius: 18px; 
            background: linear-gradient(145deg, var(--emerald), var(--dark-green));
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 800; font-size: 22px; box-shadow: 4px 4px 8px rgba(0,0,0,0.15);
        }

        /* CHAT PRIVADO OVERLAY */
        #private-chat { position: fixed; inset: 0; background: var(--soft-white); z-index: 5000; display: none; flex-direction: column; }
        .chat-top { padding: 45px 20px 15px; background: var(--pure-white); display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #eee; }
        .msg-flow { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; background: #f0f2f5; }
        
        .bubble-3d { 
            max-width: 75%; padding: 14px 18px; border-radius: 25px; font-size: 15px; 
            box-shadow: 5px 5px 15px rgba(0,0,0,0.05); position: relative;
        }
        .bubble-3d.me { align-self: flex-end; background: var(--emerald); color: white; border-bottom-right-radius: 5px; }
        .bubble-3d.them { align-self: flex-start; background: var(--pure-white); color: #333; border-bottom-left-radius: 5px; }

        /* FORMULARIO STOCK (4 PREGUNTAS) */
        .stock-card { 
            background: var(--pure-white); padding: 20px; border-radius: 20px; 
            box-shadow: var(--deep-shadow); border-left: 8px solid var(--emerald); margin-bottom: 15px;
        }
        .btn-action { 
            background: var(--dark-green); color: white; border: none; padding: 18px; 
            border-radius: 18px; width: 100%; font-weight: 800; font-size: 16px; 
            box-shadow: 0 8px 20px rgba(27,94,32,0.2); margin-top: 10px;
        }

        /* INPUTS */
        input { width: 100%; padding: 15px; border-radius: 15px; border: 2px solid #edf2f7; background: #fcfcfc; margin: 8px 0; outline: none; }
        input:focus { border-color: var(--emerald); }

        /* NAVEGACI√ìN INFERIOR */
        nav { 
            position: fixed; bottom: 0; width: 100%; height: 85px; background: var(--pure-white);
            display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 1000;
        }
        .nav-link { color: #bdc3c7; font-size: 26px; transition: 0.3s; cursor: pointer; }
        .nav-link.active { color: var(--emerald); transform: translateY(-5px); }

        /* MODALES */
        .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); z-index: 6000; display: none; align-items: flex-end; }
        .modal-body { background: var(--pure-white); width: 100%; border-radius: 35px 35px 0 0; padding: 35px; box-shadow: 0 -10px 30px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<header>
    <div class="brand">
        <div class="logo-box">R&R</div>
        <div class="app-title">rsnty y rantykuy</div>
    </div>
    <div style="font-size: 14px; font-weight: 700; color: var(--emerald);">COMPRA Y VENDE</div>
</header>

<div class="viewport" id="v">
    <div class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="font-weight: 800;">Contactos</h2>
            <button onclick="popContact()" style="background:var(--emerald); color:white; border:none; width:40px; height:40px; border-radius:12px; font-weight:bold;">+</button>
        </div>
        <div id="contacts-container"></div>
    </div>

    <div class="screen">
        <h2 style="font-weight: 800; margin-bottom:20px;">Almac√©n</h2>
        <button class="btn-action" onclick="popStock()" style="margin-bottom:25px;">+ AGREGAR PRODUCTO</button>
        <div id="stock-container"></div>
    </div>
</div>

<div id="private-chat">
    <div class="chat-top">
        <button onclick="closeChat()" style="background:none; border:none; font-size:25px;">‚Üê</button>
        <div class="av-3d" style="width:45px; height:45px; font-size:18px;" id="chat-av">?</div>
        <b id="chat-name">Vendedor</b>
    </div>
    <div class="msg-flow" id="msg-box"></div>
    <div style="padding:15px; background:white; display:flex; gap:10px;">
        <input type="text" id="minput" placeholder="Escribe un mensaje..." style="margin:0;">
        <button onclick="sendMsg()" style="background:var(--emerald); border:none; width:50px; height:50px; border-radius:15px; color:white;">‚û§</button>
    </div>
</div>

<nav>
    <div class="nav-link active" onclick="go(0, this)">üí¨</div>
    <div class="nav-link" onclick="go(1, this)">üì¶</div>
</nav>

<div class="modal-bg" id="modal-bg" onclick="this.style.display='none'">
    <div class="modal-body" onclick="event.stopPropagation()" id="modal-content"></div>
</div>

<script>
    let localData = JSON.parse(localStorage.getItem('RSR_V3')) || { contacts: [], inventory: [] };

    function save() { 
        localStorage.setItem('RSR_V3', JSON.stringify(localData)); 
        renderAll(); 
    }

    function go(p, el) {
        document.getElementById('v').style.transform = `translateX(-${p * 50}%)`;
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    // --- CONTACTOS ---
    function popContact() {
        const m = document.getElementById('modal-content');
        m.innerHTML = `
            <h3>Guardar Contacto</h3>
            <input id="new-n" placeholder="Nombre completo">
            <input id="new-t" placeholder="Etiqueta (Ej: Cliente, Proveedor)">
            <button class="btn-action" onclick="confirmContact()">GUARDAR EN AGENDA</button>
        `;
        document.getElementById('modal-bg').style.display = 'flex';
    }

    function confirmContact() {
        const name = document.getElementById('new-n').value;
        const tag = document.getElementById('new-t').value;
        if(name) {
            localData.contacts.push({ id: Date.now(), name, tag, chats: [] });
            save(); document.getElementById('modal-bg').style.display = 'none';
        }
    }

    // --- CHAT PRIVADO ---
    let currentId = null;
    function openChat(id) {
        currentId = id;
        const c = localData.contacts.find(x => x.id === id);
        document.getElementById('chat-name').innerText = c.name;
        document.getElementById('chat-av').innerText = c.name[0];
        document.getElementById('private-chat').style.display = 'flex';
        renderMsgs();
    }
    function closeChat() { document.getElementById('private-chat').style.display = 'none'; }

    function sendMsg() {
        const inp = document.getElementById('minput');
        if(!inp.value) return;
        const c = localData.contacts.find(x => x.id === currentId);
        c.chats.push({ side: 'me', text: inp.value });
        inp.value = '';
        save(); renderMsgs();
    }

    function renderMsgs() {
        const c = localData.contacts.find(x => x.id === currentId);
        document.getElementById('msg-box').innerHTML = c.chats.map(m => `
            <div class="bubble-3d ${m.side}">${m.text}</div>
        `).join('');
        const box = document.getElementById('msg-box');
        box.scrollTop = box.scrollHeight;
    }

    // --- STOCK (4 PREGUNTAS) ---
    function popStock() {
        const m = document.getElementById('modal-content');
        m.innerHTML = `
            <h3 style="color:var(--dark-green)">Registro de Mercader√≠a</h3>
            <input id="p1" placeholder="1. ¬øQu√© producto es?">
            <input id="p2" type="number" placeholder="2. Cantidad (Unid/Kg)">
            <input id="p3" type="number" placeholder="3. Precio Unitario (S/)">
            <input id="p4" placeholder="4. Ubicaci√≥n/Nota">
            <div style="margin: 10px 0; font-size:12px;">Foto (Opcional): <input type="file" style="border:none;"></div>
            <button class="btn-action" onclick="confirmStock()">ACTUALIZAR STOCK</button>
        `;
        document.getElementById('modal-bg').style.display = 'flex';
    }

    function confirmStock() {
        const prod = {
            id: Date.now(),
            name: document.getElementById('p1').value,
            qty: document.getElementById('p2').value,
            price: document.getElementById('p3').value,
            note: document.getElementById('p4').value
        };
        localData.inventory.push(prod);
        save(); document.getElementById('modal-bg').style.display = 'none';
    }

    function renderAll() {
        // Render Contactos
        document.getElementById('contacts-container').innerHTML = localData.contacts.map(c => `
            <div class="card-3d" onclick="openChat(${c.id})">
                <div class="av-3d">${c.name[0]}</div>
                <div style="flex:1">
                    <b style="font-size:16px;">${c.name}</b><br>
                    <small style="color:var(--emerald); font-weight:700;"># ${c.tag}</small>
                </div>
                <div style="font-size:18px; color:#ddd;">„Äâ</div>
            </div>
        `).join('');

        // Render Stock
        document.getElementById('stock-container').innerHTML = localData.inventory.map(s => `
            <div class="stock-card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                    <b style="font-size:18px; color:var(--dark-green);">${s.name}</b>
                    <b style="color:var(--emerald)">S/ ${parseFloat(s.price).toFixed(2)}</b>
                </div>
                <div style="font-size:14px; color:#666;">
                    üì¶ Cantidad: <b>${s.qty}</b> | üìç ${s.note}
                </div>
            </div>
        `).join('');
    }

    window.onload = renderAll;
</script>
</body>
</html>
