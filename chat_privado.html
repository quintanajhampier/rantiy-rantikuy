<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RANTIKUY EMPIRE OS v22 - TIT√ÅN SUPREMO</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            /* Identidad Huanta: Luz y Vibrancia */
            --p-green: #10b981;
            --p-vibrant: #22c55e;
            --p-gold: #f59e0b;
            --p-sky: #3b82f6;
            --p-light: #f8fafc;
            --p-white: #ffffff;
            --p-dark: #1e293b;
            --p-slate: #64748b;
            --p-red: #f43f5e;
            --p-purple: #8b5cf6;
            --p-soft-green: #f0fdf4;
            --p-soft-gold: #fffbeb;
            --p-soft-red: #fff1f2;
            --p-soft-sky: #eff6ff;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        /* --- ARQUITECTURA CORE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: var(--p-light); overflow: hidden; color: var(--p-dark); }
        
        .app-shell { display: flex; width: 600%; height: 100%; transition: transform 0.6s cubic-bezier(0.85, 0, 0.15, 1); }
        .pos-1 { transform: translateX(0%); }
        .pos-2 { transform: translateX(-16.66%); }
        .pos-3 { transform: translateX(-33.33%); }
        .pos-4 { transform: translateX(-50%); }
        .pos-5 { transform: translateX(-66.66%); }
        .pos-6 { transform: translateX(-83.33%); }

        .screen { width: 16.66%; height: 100%; display: flex; flex-direction: column; background: var(--p-white); overflow: hidden; position: relative; }

        /* --- HEADER PREMIUM --- */
        .header-main { 
            padding: 25px; background: white; border-bottom: 2px solid #f1f5f9;
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }
        .header-main h1 { margin: 0; font-size: 24px; font-weight: 800; letter-spacing: -1.5px; cursor: pointer; }
        .header-main h1 span { color: var(--p-green); }
        
        .badge-live { 
            display: flex; align-items: center; gap: 8px; font-size: 11px; font-weight: 900; 
            color: var(--p-green); background: var(--p-soft-green); padding: 6px 14px; border-radius: 50px;
        }
        .pulse-dot { width: 8px; height: 8px; background: var(--p-green); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        /* --- CHAT ESTRUCTURA TIPO WHATSAPP --- */
        #chat-list-view { flex: 1; overflow-y: auto; background: white; }
        #chat-conversation-view { flex: 1; display: none; flex-direction: column; background: #f0f2f5; position: absolute; inset: 0; z-index: 200; }
        
        .chat-item { padding: 18px 25px; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .chat-item:active { background: #f8fafc; }
        .avatar-circle { width: 50px; height: 50px; border-radius: 50%; background: var(--p-soft-green); color: var(--p-green); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 18px; }
        
        .chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 14.5px; line-height: 1.4; position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .msg.me { align-self: flex-end; background: #dcf8c6; color: #1e293b; border-top-right-radius: 4px; }
        .msg.them { align-self: flex-start; background: white; color: var(--p-dark); border-top-left-radius: 4px; }
        
        .input-box { padding: 15px; background: #f0f2f5; display: flex; gap: 10px; align-items: center; padding-bottom: calc(15px + var(--safe-bottom)); }
        .field { flex: 1; background: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 15px; outline: none; }
        
        /* --- DASHBOARD TIT√ÅN --- */
        .scroll { flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 120px; }
        .card-empire { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; padding: 35px; border-radius: 40px; margin-bottom: 30px; position: relative; overflow: hidden; }
        .card-empire::after { content: ''; position: absolute; top: -50%; right: -50%; width: 200px; height: 200px; background: rgba(255,255,255,0.05); border-radius: 50%; }
        
        .val-main { font-size: 48px; font-weight: 800; letter-spacing: -2px; margin: 10px 0; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .mini-card { background: rgba(255,255,255,0.1); padding: 18px; border-radius: 25px; backdrop-filter: blur(10px); }
        .mini-card b { font-size: 20px; display: block; margin-top: 5px; }

        /* --- PRODUCTOS & CLIENTES --- */
        .item { background: white; border-radius: 30px; padding: 20px; margin-bottom: 15px; border: 1.5px solid #f1f5f9; display: flex; align-items: center; gap: 18px; }
        .item img { width: 75px; height: 75px; border-radius: 22px; object-fit: cover; background: var(--p-soft-green); }
        .item-info { flex: 1; }
        .item-info b { font-size: 17px; display: block; margin-bottom: 4px; }
        .item-info span { color: var(--p-green); font-weight: 800; font-size: 15px; }
        
        .pill { border: none; padding: 10px 16px; border-radius: 15px; font-size: 11px; font-weight: 800; cursor: pointer; text-transform: uppercase; }

        /* --- DOCK --- */
        .dock { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(25px); padding: 15px; display: flex; justify-content: space-around; border-top: 1px solid #f1f5f9; padding-bottom: calc(15px + var(--safe-bottom)); z-index: 1000; }
        .dock-btn { border: none; background: none; font-size: 26px; color: #cbd5e1; width: 60px; height: 60px; border-radius: 22px; cursor: pointer; position: relative; }
        .dock-btn.active { color: var(--p-green); background: var(--p-soft-green); transform: scale(1.1) translateY(-5px); }
        .dock-btn::after { content: attr(data-label); position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); font-size: 9px; font-weight: 900; color: inherit; }

        /* --- MODALES --- */
        .overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(10px); z-index: 2000; display: none; align-items: flex-end; }
        .modal { background: white; width: 100%; border-radius: 45px 45px 0 0; padding: 40px; max-height: 92vh; overflow-y: auto; animation: slideUp 0.5s cubic-bezier(0, 1, 0, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .f-input { width: 100%; padding: 20px; border-radius: 22px; border: 2.5px solid #f1f5f9; font-size: 16px; margin-bottom: 20px; outline: none; }
        .f-input:focus { border-color: var(--p-green); }
        .btn-main { width: 100%; padding: 22px; border-radius: 25px; border: none; background: var(--p-green); color: white; font-weight: 800; font-size: 18px; box-shadow: 0 15px 30px rgba(16, 185, 129, 0.3); cursor: pointer; }

        .progress-container { background: #f1f5f9; height: 12px; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--p-green); width: 0%; transition: width 1s ease; }
    </style>
</head>
<body>

<div class="app-shell" id="appShell">
    
    <div class="screen">
        <header class="header-main">
            <h1 onclick="handleSecretTaps()">Empire<span>.OS</span></h1>
            <div class="badge-live"><div class="pulse-dot"></div> MANDO ACTIVO</div>
        </header>
        
        <div id="chat-list-view"></div>

        <div id="chat-conversation-view">
            <header class="header-main" style="padding: 15px 25px;">
                <button onclick="closeChat()" style="border:none; background:none; font-size:20px;">‚¨ÖÔ∏è</button>
                <div id="chat-target-name" style="font-weight:800; flex:1; margin-left:15px;">Nombre</div>
            </header>
            <div class="chat-area" id="chat-flow"></div>
            <div class="input-box">
                <input type="text" id="chat-input" class="field" placeholder="Escribe un mensaje..." onkeypress="if(event.key==='Enter') logic_send()">
                <button class="btn-circle" style="width:45px; height:45px;" onclick="logic_send()">üöÄ</button>
            </div>
        </div>
    </div>

    <div class="screen">
        <header class="header-main"><h1>Master<span>.Stock</span></h1></header>
        <div class="scroll">
            <div class="card-empire">
                <span class="stat-label">CAPITAL EN CAJA</span>
                <div class="val-main" id="ui-caja">S/ 0.00</div>
                <div class="grid-2">
                    <div class="mini-card"><span>Fiados</span><b id="ui-deuda" style="color:var(--p-gold);">S/ 0.00</b></div>
                    <div class="mini-card"><span>Gastos</span><b id="ui-gasto" style="color:var(--p-red);">S/ 0.00</b></div>
                </div>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <b style="font-size:20px;">Inventario Real</b>
                <button class="pill" style="background:var(--p-dark); color:white;" onclick="ui_modalStock()">+ Agregar</button>
            </div>
            <div id="render-stock"></div>
        </div>
    </div>

    <div class="screen">
        <header class="header-main"><h1>Empire<span>.Clients</span></h1></header>
        <div class="scroll">
            <div class="card-empire" style="background:var(--p-soft-sky); color:var(--p-dark);">
                <span class="stat-label">CLIENTES REGISTRADOS</span>
                <div class="val-main" id="ui-client-count">0</div>
                <button class="btn-main" style="padding:10px; font-size:12px;" onclick="ui_modalClient()">+ NUEVO CLIENTE</button>
            </div>
            <div id="render-clients"></div>
        </div>
    </div>

    <div class="screen">
        <header class="header-main"><h1>Ruta<span>.Logistics</span></h1></header>
        <div class="scroll" id="render-routes"></div>
        <div style="padding:20px; position:absolute; bottom:80px; width:100%;">
            <button class="btn-main" onclick="ui_modalRoute()">PROGRAMAR DESPACHO</button>
        </div>
    </div>

    <div class="screen">
        <header class="header-main"><h1>Data<span>.Center</span></h1></header>
        <div class="scroll">
            <div class="card-empire" style="background:white; border:2px solid #f1f5f9; color:var(--p-dark);">
                <span class="stat-label">META DEL MES (S/ 50,000)</span>
                <div class="val-main" id="ui-utilidad" style="color:var(--p-green);">S/ 0.00</div>
                <div class="progress-container"><div class="progress-bar" id="ui-progress"></div></div>
                <small id="ui-meta-text">0% completado para el objetivo.</small>
            </div>
            <h3>Historial de Movimientos</h3>
            <div id="render-audit"></div>
        </div>
    </div>

    <div class="screen">
        <header class="header-main"><h1>System<span>.v22</span></h1></header>
        <div class="scroll">
            <div style="padding:30px; background:var(--p-dark); color:white; border-radius:35px; margin-bottom:25px;">
                <b>ESTADO DEL SISTEMA</b><br>
                <small>Huanta Nodo: Online</small><br>
                <small>Base de Datos: Local Encrypt</small>
            </div>
            <button class="f-input" onclick="logic_export()">üì¶ EXPORTAR BACKUP DEL IMPERIO</button>
            <button class="f-input" style="color:var(--p-red);" onclick="logic_reset()">‚ö†Ô∏è DESTRUCCI√ìN DE DATOS (RESET)</button>
        </div>
    </div>

</div>

<nav class="dock">
    <button class="dock-btn active" onclick="nav(1)" data-label="Mando">üè¢</button>
    <button class="dock-btn" onclick="nav(2)" data-label="Stock">üõçÔ∏è</button>
    <button class="dock-btn" onclick="nav(3)" data-label="Socios">üë•</button>
    <button class="dock-btn" onclick="nav(4)" data-label="Rutas">üöõ</button>
    <button class="dock-btn" onclick="nav(5)" data-label="Data">üìä</button>
    <button class="dock-btn" onclick="nav(6)" data-label="Config">‚öôÔ∏è</button>
</nav>

<div class="overlay" id="overlay" onclick="if(event.target==this) closeM()">
    <div class="modal" id="modal-content"></div>
</div>

<script>
    // --- N√öCLEO DE DATOS SUPREMO ---
    let db = JSON.parse(localStorage.getItem('RANTIKUY_TITAN_DB')) || {
        caja: 0,
        inventario: [],
        deudas: [],
        gastos: [],
        clientes: [
            { id: 101, name: "Mayorista Huanta", phone: "987654321", chats: [{u:'THEM', t:'¬øTienes stock de fertilizantes?', h:'10:30'}] },
            { id: 102, name: "Distribuidora Ayacucho", phone: "912345678", chats: [{u:'THEM', t:'Pedido de ma√±ana listo.', h:'09:15'}] }
        ],
        rutas: [],
        audit: [],
        currentChatId: null
    };

    function save() {
        localStorage.setItem('RANTIKUY_TITAN_DB', JSON.stringify(db));
        updateUI();
    }

    // --- NAVEGACI√ìN ---
    function nav(p) {
        document.getElementById('appShell').className = 'app-shell pos-' + p;
        document.querySelectorAll('.dock-btn').forEach((b, i) => b.classList.toggle('active', (i+1)===p));
    }

    // --- L√ìGICA DE MENSAJER√çA TIPO WHATSAPP ---
    function openChat(clientId) {
        db.currentChatId = clientId;
        const client = db.clientes.find(c => c.id === clientId);
        document.getElementById('chat-target-name').innerText = client.name;
        document.getElementById('chat-conversation-view').style.display = 'flex';
        renderChatContent();
    }

    function closeChat() {
        document.getElementById('chat-conversation-view').style.display = 'none';
        db.currentChatId = null;
    }

    function renderChatList() {
        document.getElementById('chat-list-view').innerHTML = db.clientes.map(c => {
            const lastMsg = c.chats && c.chats.length > 0 ? c.chats[c.chats.length-1].t : "Sin mensajes";
            return `
                <div class="chat-item" onclick="openChat(${c.id})">
                    <div class="avatar-circle">${c.name[0]}</div>
                    <div style="flex:1">
                        <div style="font-weight:700;">${c.name}</div>
                        <div style="font-size:13px; color:#64748b; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; width:200px;">${lastMsg}</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderChatContent() {
        const client = db.clientes.find(c => c.id === db.currentChatId);
        if(!client) return;
        document.getElementById('chat-flow').innerHTML = client.chats.map(m => `
            <div class="msg ${m.u === 'ME' ? 'me' : 'them'}">
                ${m.t}
                <div style="font-size:9px; text-align:right; margin-top:4px; opacity:0.5;">${m.h}</div>
            </div>
        `).join('');
        const area = document.getElementById('chat-flow');
        area.scrollTop = area.scrollHeight;
    }

    function logic_send() {
        const inp = document.getElementById('chat-input');
        if(!inp.value.trim() || !db.currentChatId) return;
        
        const client = db.clientes.find(c => c.id === db.currentChatId);
        const time = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        
        client.chats.push({ u: 'ME', t: inp.value, h: time });
        
        // Simular respuesta del cliente
        setTimeout(() => {
            client.chats.push({ u: 'THEM', t: "Copiado, procesando orden.", h: time });
            save();
        }, 1000);

        inp.value = '';
        save();
    }

    // --- FUNCIONES DE NEGOCIO ---
    function logic_sell(id, isFiado) {
        const idx = db.inventario.findIndex(x => x.id === id);
        const item = db.inventario[idx];

        if(isFiado) {
            const cli = prompt("¬øA qu√© cliente se le f√≠a?");
            if(!cli) return;
            db.deudas.push({ id: Date.now(), cliente: cli, monto: item.precio, item: item.nombre });
        } else {
            db.caja += item.precio;
            db.audit.push({ t: `Venta: ${item.nombre}`, v: item.precio, type: 'plus' });
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        }
        
        db.inventario.splice(idx, 1);
        save();
    }

    // --- UI RENDERERS ---
    function updateUI() {
        document.getElementById('ui-caja').innerText = `S/ ${db.caja.toFixed(2)}`;
        document.getElementById('ui-deuda').innerText = `S/ ${db.deudas.reduce((a,b)=>a+b.monto,0).toFixed(2)}`;
        document.getElementById('ui-gasto').innerText = `S/ ${db.gastos.reduce((a,b)=>a+b.monto,0).toFixed(2)}`;
        document.getElementById('ui-utilidad').innerText = `S/ ${db.caja.toFixed(2)}`;
        document.getElementById('ui-client-count').innerText = db.clientes.length;

        const meta = 50000;
        const porc = Math.min((db.caja / meta) * 100, 100);
        document.getElementById('ui-progress').style.width = porc + '%';
        document.getElementById('ui-meta-text').innerText = `${porc.toFixed(1)}% de la meta de S/ 50,000 alcanzada.`;

        renderChatList();
        if(db.currentChatId) renderChatContent();
        renderStock();
        renderClients();
        renderAudit();
        renderRoutes();
    }

    function renderStock() {
        document.getElementById('render-stock').innerHTML = db.inventario.map(i => `
            <div class="item">
                <img src="${i.img || 'https://via.placeholder.com/80?text=üì¶'}">
                <div class="item-info">
                    <b>${i.nombre}</b>
                    <span>S/ ${i.precio.toFixed(2)}</span>
                </div>
                <div style="display:flex; flex-direction:column; gap:5px;">
                    <button class="pill" style="background:var(--p-soft-green); color:var(--p-green);" onclick="logic_sell(${i.id}, false)">Venta</button>
                    <button class="pill" style="background:var(--p-soft-gold); color:var(--p-gold);" onclick="logic_sell(${i.id}, true)">Fiado</button>
                </div>
            </div>
        `).join('');
    }

    function renderClients() {
        document.getElementById('render-clients').innerHTML = db.clientes.map(c => `
            <div class="item">
                <div class="avatar-circle" style="background:var(--p-soft-sky); color:var(--p-sky);">
                    ${c.name[0]}
                </div>
                <div class="item-info">
                    <b>${c.name}</b>
                    <small>${c.phone}</small>
                </div>
                <button class="pill" style="background:var(--p-soft-sky); color:var(--p-sky);" onclick="nav(1); openChat(${c.id})">Mensaje</button>
            </div>
        `).join('');
    }

    function renderRoutes() {
        document.getElementById('render-routes').innerHTML = db.rutas.map((r, i) => `
            <div class="item" style="border-left:8px solid var(--p-purple);">
                <div class="item-info">
                    <b>üìç ${r.dest}</b>
                    <small>${r.obs}</small>
                </div>
                <button class="pill" style="background:var(--p-red); color:white;" onclick="db.rutas.splice(${i},1); save();">X</button>
            </div>
        `).join('') || '<p style="text-align:center; padding:50px;">Cielo despejado. No hay rutas.</p>';
    }

    function renderAudit() {
        document.getElementById('render-audit').innerHTML = db.audit.slice().reverse().map(a => `
            <div style="padding:15px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                <span>${a.t}</span>
                <b style="color:${a.type==='plus'?'var(--p-green)':'var(--p-red)'}">${a.type==='plus'?'+':'-'} S/ ${a.v.toFixed(2)}</b>
            </div>
        `).join('');
    }

    // --- MODALES ---
    function ui_modalStock() {
        showM(`
            <h2>Cargar Mercader√≠a</h2>
            <input type="text" id="in-n" class="f-input" placeholder="Nombre del Producto">
            <input type="number" id="in-p" class="f-input" placeholder="Precio de Venta (S/)">
            <input type="file" id="in-i" class="f-input">
            <button class="btn-main" onclick="logic_addStock()">A√ëADIR AL ALMAC√âN</button>
        `);
    }

    function logic_addStock() {
        const n = document.getElementById('in-n').value;
        const p = parseFloat(document.getElementById('in-p').value);
        const f = document.getElementById('in-i').files[0];
        if(!n || isNaN(p)) return;
        
        const reader = new FileReader();
        reader.onload = () => {
            db.inventario.push({ id: Date.now(), nombre: n, precio: p, img: reader.result });
            save(); closeM();
        };
        if(f) reader.readAsDataURL(f); else {
            db.inventario.push({ id: Date.now(), nombre: n, precio: p, img: null });
            save(); closeM();
        }
    }

    function ui_modalClient() {
        showM(`
            <h2>Nuevo Socio Comercial</h2>
            <input type="text" id="c-n" class="f-input" placeholder="Nombre completo">
            <input type="text" id="c-p" class="f-input" placeholder="Tel√©fono / WhatsApp">
            <button class="btn-main" onclick="logic_addClient()">REGISTRAR CLIENTE</button>
        `);
    }

    function logic_addClient() {
        const n = document.getElementById('c-n').value;
        const p = document.getElementById('c-p').value;
        if(!n) return;
        db.clientes.push({ id: Date.now(), name: n, phone: p, chats: [] });
        save(); closeM();
    }

    function ui_modalRoute() {
        showM(`
            <h2>Programar Despacho</h2>
            <input type="text" id="r-d" class="f-input" placeholder="Lugar de entrega">
            <input type="text" id="r-o" class="f-input" placeholder="Detalles (Ej. Cami√≥n Blanco)">
            <button class="btn-main" style="background:var(--p-purple);" onclick="logic_addRoute()">LANZAR RUTA</button>
        `);
    }

    function logic_addRoute() {
        const d = document.getElementById('r-d').value;
        const o = document.getElementById('r-o').value;
        if(!d) return;
        db.rutas.push({ dest: d, obs: o });
        save(); closeM();
    }

    function showM(h) { document.getElementById('modal-content').innerHTML = h; document.getElementById('overlay').style.display = 'flex'; }
    function closeM() { document.getElementById('overlay').style.display = 'none'; }
    function logic_export() { 
        const b = new Blob([JSON.stringify(db)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'EMPIRE_DATA.json'; a.click();
    }
    function logic_reset() { if(confirm("¬øBORRAR EL IMPERIO?")) { localStorage.clear(); location.reload(); } }
    
    function handleSecretTaps() {
        window.t = (window.t || 0) + 1;
        if(window.t >= 7) { alert("PANEL ADMIN: Consola desbloqueada."); console.log(db); window.t = 0; }
        setTimeout(() => window.t = 0, 3000);
    }

    window.onload = updateUI;
</script>
</body>
</html>
