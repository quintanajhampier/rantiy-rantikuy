<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RANTIKUY EMPIRE OS v21 - ULTRA TITN</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --p-green: #10b981;
            --p-vibrant: #22c55e;
            --p-gold: #f59e0b;
            --p-sky: #0ea5e9;
            --p-light: #f8fafc;
            --p-white: #ffffff;
            --p-dark: #0f172a;
            --p-slate: #64748b;
            --p-red: #ef4444;
            --p-soft-green: #ecfdf5;
            --p-soft-gold: #fffbeb;
            --p-soft-red: #fef2f2;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        /* --- RESET & ESTRUCTURA --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.2s ease; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: var(--p-light); overflow: hidden; color: var(--p-dark); }
        
        .app-shell { display: flex; width: 500%; height: 100%; transition: transform 0.6s cubic-bezier(0.85, 0, 0.15, 1); }
        .pos-1 { transform: translateX(0%); }
        .pos-2 { transform: translateX(-20%); }
        .pos-3 { transform: translateX(-40%); }
        .pos-4 { transform: translateX(-60%); }
        .pos-5 { transform: translateX(-80%); }

        .screen { width: 20%; height: 100%; display: flex; flex-direction: column; background: var(--p-white); overflow: hidden; position: relative; }

        /* --- HEADER --- */
        .header-premium { 
            padding: 25px; background: white; border-bottom: 2px solid #f1f5f9;
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }
        .header-premium h1 { margin: 0; font-size: 24px; font-weight: 800; letter-spacing: -1px; cursor: pointer; }
        .header-premium h1 span { color: var(--p-green); }
        .live-tag { font-size: 9px; font-weight: 900; background: var(--p-soft-green); color: var(--p-green); padding: 4px 10px; border-radius: 8px; text-transform: uppercase; animation: pulse 2s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* --- CONTENIDO --- */
        .scroll-area { flex: 1; overflow-y: auto; padding: 20px; background: #fafbfc; padding-bottom: 120px; }
        
        /* --- TARJETAS DE MTRICAS --- */
        .main-card { 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white; padding: 30px; border-radius: 35px; margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(15,23,42,0.25);
        }
        .val-big { font-size: 48px; font-weight: 800; letter-spacing: -2px; margin: 10px 0; }
        .sub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .sub-item { background: rgba(255,255,255,0.07); padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .sub-item label { font-size: 10px; opacity: 0.6; font-weight: 700; text-transform: uppercase; }
        .sub-item div { font-size: 18px; font-weight: 700; margin-top: 4px; }

        /* --- BOTONES DE COMANDO --- */
        .grid-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 25px; }
        .btn-cmd { 
            background: white; border: 1px solid #eef2f6; border-radius: 25px; padding: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02); cursor: pointer;
        }
        .btn-cmd:active { transform: scale(0.95); background: var(--p-soft-green); }
        .btn-cmd i { font-size: 30px; }
        .btn-cmd b { font-size: 13px; color: var(--p-dark); }

        /* --- LISTAS DE INVENTARIO --- */
        .inventory-box { background: white; border-radius: 30px; border: 1px solid #f1f5f9; overflow: hidden; }
        .inv-row { 
            display: flex; align-items: center; padding: 15px 20px; border-bottom: 1px solid #f1f5f9; gap: 15px;
        }
        .inv-row:last-child { border-bottom: none; }
        .inv-img { width: 55px; height: 55px; border-radius: 18px; background: #f8fafc; object-fit: cover; }
        .inv-details { flex: 1; }
        .inv-details b { font-size: 15px; color: var(--p-dark); display: block; }
        .inv-details span { font-size: 13px; color: var(--p-green); font-weight: 700; }
        
        .pill-group { display: flex; gap: 6px; }
        .pill-btn { border: none; padding: 10px; border-radius: 12px; font-size: 10px; font-weight: 800; cursor: pointer; }
        .pill-buy { background: var(--p-soft-green); color: var(--p-green); }
        .pill-fiado { background: var(--p-soft-gold); color: var(--p-gold); }

        /* --- CHAT --- */
        .chat-view { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; background: #f0f2f5; }
        .msg { max-width: 85%; padding: 15px 18px; border-radius: 22px; font-size: 14px; line-height: 1.4; position: relative; }
        .msg-lider { align-self: flex-end; background: var(--p-green); color: white; border-bottom-right-radius: 4px; }
        .msg-socio { align-self: flex-start; background: white; border-bottom-left-radius: 4px; }
        .msg-time { font-size: 8px; opacity: 0.6; display: block; margin-top: 5px; text-align: right; }

        /* --- NAVEGACIN DOCK --- */
        .dock { 
            position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px); padding: 12px 10px; display: flex; justify-content: space-around;
            border-top: 1px solid #f1f5f9; padding-bottom: calc(12px + var(--safe-bottom)); z-index: 1000;
        }
        .dock-item { border: none; background: none; font-size: 24px; color: #cbd5e1; width: 55px; height: 55px; border-radius: 20px; cursor: pointer; }
        .dock-item.active { color: var(--p-green); background: var(--p-soft-green); }

        /* --- MODALES --- */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: flex-end; }
        .modal { background: white; width: 100%; border-radius: 35px 35px 0 0; padding: 30px; max-height: 85vh; overflow-y: auto; }
        .f-group { margin-bottom: 15px; }
        .f-label { font-size: 11px; font-weight: 800; color: var(--p-slate); text-transform: uppercase; margin-bottom: 8px; display: block; }
        .f-input { width: 100%; padding: 18px; border-radius: 15px; border: 2px solid #f1f5f9; font-size: 15px; outline: none; }
        .f-btn-full { width: 100%; padding: 20px; border-radius: 20px; border: none; background: var(--p-green); color: white; font-weight: 800; font-size: 16px; margin-top: 10px; }

        /* --- GRFICOS CSS --- */
        .chart-container { display: flex; align-items: flex-end; gap: 8px; height: 100px; margin-top: 20px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 15px; }
        .bar { flex: 1; background: var(--p-green); border-radius: 4px 4px 0 0; min-height: 5px; position: relative; }
        .bar::after { content: attr(data-val); position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 7px; color: white; }

        /* --- RECIBO --- */
        .receipt-card { background: white; padding: 20px; border: 2px dashed #ccc; font-family: 'Courier New', Courier, monospace; color: black; }
    </style>
</head>
<body>

<div class="app-shell" id="appShell">
    
    <div class="screen">
        <header class="header-premium">
            <h1 onclick="handleAdminTaps()">Rantikuy<span>.Empire</span></h1>
            <div class="live-tag">Sistema Activo</div>
        </header>

        <div class="scroll-area">
            <div class="main-card">
                <label style="font-size:11px; font-weight:800; opacity:0.7;">TOTAL EN CAJA (HUANTA)</label>
                <div class="val-big" id="caja-val">S/ 0.00</div>
                
                <div class="sub-grid">
                    <div class="sub-item">
                        <label>Por Cobrar</label>
                        <div id="deuda-val" style="color:var(--p-gold);">S/ 0.00</div>
                    </div>
                    <div class="sub-item">
                        <label>Gastos Hoy</label>
                        <div id="gasto-val" style="color:var(--p-red);">S/ 0.00</div>
                    </div>
                </div>

                <div class="chart-container" id="ventas-chart">
                    </div>
            </div>

            <div class="grid-actions">
                <div class="btn-cmd" onclick="ui_modalAddStock()"><i></i><b>Cargar Stock</b></div>
                <div class="btn-cmd" onclick="navTo(3)"><i></i><b>Log铆stica</b></div>
                <div class="btn-cmd" onclick="ui_modalAddGasto()"><i></i><b>Gasto</b></div>
                <div class="btn-cmd" onclick="ui_showDeudas()"><i></i><b>Fiados</b></div>
            </div>

            <div class="inventory-box">
                <div style="padding:20px; border-bottom:1px solid #f1f5f9; display:flex; justify-content:space-between;">
                    <b style="font-size:16px;">Radar de Almac茅n</b>
                    <input type="text" id="search-box" placeholder="Filtrar..." oninput="renderInventory()" style="border:none; background:#f1f5f9; padding:5px 10px; border-radius:8px; font-size:12px;">
                </div>
                <div id="inventory-list">
                    </div>
            </div>
        </div>
    </div>

    <div class="screen">
        <header class="header-premium"><b>Mesa de Negocios</b></header>
        <div id="chat-flow" class="chat-view"></div>
        <div style="padding:15px; background:white; border-top:1px solid #eee; display:flex; gap:10px; padding-bottom:100px;">
            <input type="text" id="chat-msg" class="f-input" style="padding:12px;" placeholder="Mensaje al equipo...">
            <button onclick="logic_sendChat()" class="f-btn-full" style="width:60px; margin:0; padding:0;"></button>
        </div>
    </div>

    <div class="screen">
        <header class="header-premium"><b>Centro de Despachos</b></header>
        <div class="scroll-area" id="logistics-flow">
            </div>
        <button class="f-btn-full" style="position:fixed; bottom:100px; left:20px; width:calc(20% - 40px);" onclick="ui_modalAddRoute()">PROGRAMAR RUTA</button>
    </div>

    <div class="screen">
        <header class="header-premium"><b>Inteligencia de Datos</b></header>
        <div class="scroll-area">
            <div class="main-card" style="background:var(--p-white); color:var(--p-dark); border:1px solid #eee;">
                <h3>Balance de Utilidad</h3>
                <div id="utilidad-total" style="font-size:32px; font-weight:800; color:var(--p-green);">S/ 0.00</div>
                <hr>
                <div id="metricas-historial">
                    </div>
            </div>
        </div>
    </div>

    <div class="screen">
        <header class="header-premium"><b>Configuraci贸n Empire</b></header>
        <div class="scroll-area">
            <div style="padding:20px; background:var(--p-dark); color:white; border-radius:25px; margin-bottom:20px;">
                <b>ID de Dispositivo:</b> HUANTA-V21-PRO<br>
                <b>Versi贸n:</b> 21.0.1 (Stable)<br>
                <b>Nivel:</b> Supremo Administrador
            </div>
            <button class="f-btn-full" style="background:#000;" onclick="logic_exportData()">EXPORTAR BASE DE DATOS</button>
            <button class="f-btn-full" style="background:var(--p-red);" onclick="logic_factoryReset()">DESTRUCCIN TOTAL</button>
        </div>
    </div>

</div>

<nav class="dock">
    <button class="dock-item active" onclick="navTo(1)"></button>
    <button class="dock-item" onclick="navTo(2)"></button>
    <button class="dock-item" onclick="navTo(3)"></button>
    <button class="dock-item" onclick="navTo(4)"></button>
    <button class="dock-item" onclick="navTo(5)">锔</button>
</nav>

<div class="overlay" id="overlay" onclick="if(event.target==this) closeModal()">
    <div class="modal" id="modal-content"></div>
</div>

<script>
    // --- MOTOR DE DATOS ---
    const DB_NAME = 'rantikuy_v21_master_db';
    let db = JSON.parse(localStorage.getItem(DB_NAME)) || {
        caja: 0,
        inventario: [],
        deudas: [],
        gastos: [],
        ventas_historial: [],
        rutas: [],
        chats: [{u:'Admin', t:'Sistema V21 Listo. Esperando 贸rdenes.', h:'Ahora'}]
    };

    function saveDB() {
        localStorage.setItem(DB_NAME, JSON.stringify(db));
        refreshUI();
    }

    function refreshUI() {
        document.getElementById('caja-val').innerText = 'S/ ' + db.caja.toFixed(2);
        
        const totDeuda = db.deudas.reduce((a, b) => a + b.monto, 0);
        document.getElementById('deuda-val').innerText = 'S/ ' + totDeuda.toFixed(2);

        const totGasto = db.gastos.reduce((a, b) => a + b.monto, 0);
        document.getElementById('gasto-val').innerText = 'S/ ' + totGasto.toFixed(2);

        renderInventory();
        renderCharts();
        renderChats();
        renderLogistics();
        renderMetricas();
    }

    // --- LGICA DE INVENTARIO ---
    function renderInventory() {
        const query = document.getElementById('search-box').value.toLowerCase();
        const container = document.getElementById('inventory-list');
        const items = db.inventario.filter(i => i.nombre.toLowerCase().includes(query));

        container.innerHTML = items.length ? items.map(item => `
            <div class="inv-row">
                <img src="${item.img || 'https://via.placeholder.com/60?text='}" class="inv-img">
                <div class="inv-details">
                    <b>${item.nombre}</b>
                    <span>S/ ${item.precio.toFixed(2)}</span>
                </div>
                <div class="pill-group">
                    <button class="pill-btn pill-buy" onclick="logic_vender(${item.id}, false)">Venta</button>
                    <button class="pill-btn pill-fiado" onclick="logic_vender(${item.id}, true)">Fiado</button>
                    <button class="pill-btn" style="background:#fee2e2; color:red;" onclick="logic_delStock(${item.id})"></button>
                </div>
            </div>
        `).join('') : '<p style="text-align:center; padding:30px; color:gray;">No hay stock.</p>';
    }

    function logic_vender(id, esFiado) {
        const idx = db.inventario.findIndex(x => x.id === id);
        const p = db.inventario[idx];

        if(esFiado) {
            const cliente = prompt("Nombre del Cliente Deudor:");
            if(!cliente) return;
            db.deudas.push({ id: Date.now(), cliente, producto: p.nombre, monto: p.precio, fecha: new Date().toLocaleDateString() });
        } else {
            db.caja += p.precio;
            db.ventas_historial.push({ nombre: p.nombre, monto: p.precio, fecha: new Date().toLocaleDateString() });
            confetti({ particleCount: 100, spread: 70 });
            ui_showTicket(p);
        }

        db.inventario.splice(idx, 1);
        saveDB();
    }

    // --- MODALES ---
    function ui_modalAddStock() {
        showModal(`
            <h2> Nuevo Ingreso</h2>
            <div class="f-group">
                <label class="f-label">Producto</label>
                <input type="text" id="add-n" class="f-input" placeholder="Ej. Fertilizante 50kg">
            </div>
            <div class="f-group">
                <label class="f-label">Precio de Venta (S/)</label>
                <input type="number" id="add-p" class="f-input" placeholder="0.00">
            </div>
            <div class="f-group">
                <label class="f-label">Foto</label>
                <input type="file" id="add-f" class="f-input" accept="image/*">
            </div>
            <button class="f-btn-full" onclick="logic_addStock()">GUARDAR EN SISTEMA</button>
        `);
    }

    function logic_addStock() {
        const n = document.getElementById('add-n').value;
        const p = parseFloat(document.getElementById('add-p').value);
        const f = document.getElementById('add-f').files[0];
        if(!n || isNaN(p)) return;

        const process = (imgData = '') => {
            db.inventario.push({ id: Date.now(), nombre: n, precio: p, img: imgData });
            saveDB(); closeModal();
        };

        if(f) {
            const reader = new FileReader();
            reader.onload = (e) => process(e.target.result);
            reader.readAsDataURL(f);
        } else process();
    }

    function ui_showTicket(p) {
        showModal(`
            <div class="receipt-card">
                <center>
                    <b>RANTIKUY EMPIRE</b><br>
                    HUANTA - PERU<br>
                    -------------------------<br>
                    TICKET DE VENTA<br>
                </center>
                FECHA: ${new Date().toLocaleString()}<br>
                ITEM: ${p.nombre}<br>
                TOTAL: S/ ${p.precio.toFixed(2)}<br>
                -------------------------<br>
                <center>隆ESTE ES TU IMPERIO!</center>
            </div>
            <button class="f-btn-full" style="background:#000;" onclick="closeModal()">LISTO</button>
        `);
    }

    function ui_showDeudas() {
        const list = db.deudas.map((d, i) => `
            <div style="background:var(--p-soft-gold); padding:15px; border-radius:15px; margin-bottom:10px;">
                <b> ${d.cliente}</b><br>
                <small>${d.producto} - ${d.fecha}</small><br>
                <b style="color:var(--p-gold);">S/ ${d.monto.toFixed(2)}</b>
                <button onclick="logic_cobrar(${i})" style="float:right; border:none; background:var(--p-green); color:white; border-radius:8px; padding:5px 10px;">COBRAR</button>
            </div>
        `).join('');
        showModal(`<h2>Cuentas por Cobrar</h2>${list || 'Sin pendientes'}`);
    }

    function logic_cobrar(i) {
        db.caja += db.deudas[i].monto;
        db.ventas_historial.push({ nombre: 'COBRO: ' + db.deudas[i].cliente, monto: db.deudas[i].monto, fecha: new Date().toLocaleDateString() });
        db.deudas.splice(i, 1);
        saveDB(); closeModal();
    }

    // --- GRFICOS Y MTRICAS ---
    function renderCharts() {
        const chart = document.getElementById('ventas-chart');
        // Agrupar ultimas 7 ventas para el grafico
        const ultimas = db.ventas_historial.slice(-7);
        chart.innerHTML = ultimas.map(v => {
            const h = Math.min((v.monto / 500) * 100, 100); // Escala
            return `<div class="bar" style="height:${h}%" data-val="${v.monto}"></div>`;
        }).join('');
    }

    function renderMetricas() {
        const hist = document.getElementById('metricas-historial');
        hist.innerHTML = db.ventas_historial.slice().reverse().map(v => `
            <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #f1f5f9;">
                <span>${v.nombre}</span>
                <b style="color:var(--p-green);">+ S/ ${v.monto.toFixed(2)}</b>
            </div>
        `).join('');
    }

    // --- LOGSTICA ---
    function renderLogistics() {
        const flow = document.getElementById('logistics-flow');
        flow.innerHTML = db.rutas.map((r, i) => `
            <div style="background:white; padding:20px; border-radius:20px; margin-bottom:10px; border-left:5px solid var(--p-gold);">
                <b> Destino: ${r.dest}</b><br>
                <p style="margin:5px 0;">${r.obs}</p>
                <button onclick="db.rutas.splice(${i},1); saveDB()" class="pill-btn" style="background:var(--p-soft-red); color:red;">COMPLETADO / ELIMINAR</button>
            </div>
        `).join('');
    }

    function ui_modalAddRoute() {
        showModal(`
            <h2> Nueva Ruta</h2>
            <input type="text" id="r-dest" class="f-input" placeholder="Direcci贸n / Punto de entrega">
            <textarea id="r-obs" class="f-input" placeholder="Observaciones..." style="margin-top:10px;"></textarea>
            <button class="f-btn-full" onclick="logic_addRoute()">GUARDAR RUTA</button>
        `);
    }

    function logic_addRoute() {
        const dest = document.getElementById('r-dest').value;
        const obs = document.getElementById('r-obs').value;
        if(!dest) return;
        db.rutas.push({ dest, obs });
        saveDB(); closeModal();
    }

    // --- CHAT ---
    function renderChats() {
        const f = document.getElementById('chat-flow');
        f.innerHTML = db.chats.map(c => `
            <div class="msg ${c.u==='Lider'?'msg-lider':'msg-socio'}">
                <b>${c.u}:</b> ${c.t}
                <span class="msg-time">${c.h}</span>
            </div>
        `).join('');
        f.scrollTop = f.scrollHeight;
    }

    function logic_sendChat() {
        const m = document.getElementById('chat-msg');
        if(!m.value) return;
        db.chats.push({ u: 'Lider', t: m.value, h: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) });
        m.value = '';
        saveDB();
    }

    // --- UTILIDADES ---
    function navTo(p) {
        document.getElementById('appShell').className = 'app-shell pos-' + p;
        document.querySelectorAll('.dock-item').forEach((it, i) => it.classList.toggle('active', i+1 === p));
    }

    function showModal(html) {
        document.getElementById('modal-content').innerHTML = html;
        document.getElementById('overlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('overlay').style.display = 'none'; }

    let taps = 0;
    function handleAdminTaps() {
        taps++;
        if(taps >= 7) {
            showModal(`<h2>ADMIN RAW DATA</h2><pre style="background:#eee; padding:10px; font-size:9px; border-radius:10px; overflow:auto; max-height:400px;">${JSON.stringify(db, null, 2)}</pre>`);
            taps = 0;
        }
        setTimeout(() => taps = 0, 3000);
    }

    function logic_exportData() {
        const blob = new Blob([JSON.stringify(db)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'rantikuy_backup.json';
        a.click();
    }

    function logic_factoryReset() {
        if(confirm("隆ATENCIN! Se borrar谩n todos los datos del imperio de forma irreversible.")) {
            localStorage.clear();
            location.reload();
        }
    }

    window.onload = refreshUI;
</script>
</body>
</html>
