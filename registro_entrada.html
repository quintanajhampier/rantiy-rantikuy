<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rantiy y Rantikuy - Ingreso Seguro</title>
    <style>
        /* Colores vibrantes de Huanta: Verde Mercado y Naranja Energ√≠a */
        body { background-color: #f0fff4; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .contenedor { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(45, 106, 79, 0.1); width: 90%; max-width: 400px; text-align: center; border: 2px solid #4ade80; }
        
        h1 { color: #2d6a4f; margin-bottom: 5px; font-size: 24px; }
        .eslogan { color: #ff8c00; font-weight: bold; font-size: 14px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        
        .alerta-gps { background: #fffbeb; border-left: 5px solid #ff8c00; padding: 12px; margin-bottom: 20px; font-size: 12px; color: #92400e; text-align: left; border-radius: 8px; }
        
        input { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #e2e8f0; border-radius: 12px; outline: none; box-sizing: border-box; transition: 0.3s; font-size: 16px; }
        input:focus { border-color: #4ade80; box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.2); }
        
        .terminos-box { background: #f8fafc; padding: 15px; border-radius: 12px; height: 110px; overflow-y: scroll; font-size: 11px; color: #475569; text-align: left; margin: 15px 0; border: 1px solid #e2e8f0; line-height: 1.4; }
        
        .check-group { display: flex; align-items: flex-start; gap: 10px; font-size: 12px; color: #1e293b; text-align: left; cursor: pointer; margin-bottom: 15px; }
        .check-group input { width: auto; margin-top: 3px; }
        
        .btn-ingresar { background: linear-gradient(135deg, #4ade80, #2d6a4f); color: white; border: none; padding: 16px; width: 100%; border-radius: 15px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.2); }
        .btn-ingresar:active { transform: scale(0.98); }
        .btn-ingresar:disabled { background: #cbd5e1; cursor: not-allowed; box-shadow: none; }
        
        #status { font-size: 13px; font-weight: 600; margin-top: 15px; min-height: 20px; }
        .loading-dot { animation: blink 1.4s infinite both; }
        @keyframes blink { 0% { opacity: .2; } 20% { opacity: 1; } 100% { opacity: .2; } }
    </style>
</head>
<body>

<div class="contenedor">
    <h1>Rantiy y Rantikuy</h1>
    <div class="eslogan">Mercado Serio - Cero Estafas</div>

    <div class="alerta-gps">
        üìç <b>Seguridad del Imperio:</b> Si el GPS no carga, toca el <b>candado</b> üîí arriba en la direcci√≥n y activa "Ubicaci√≥n".
    </div>

    <input type="text" id="nombre" placeholder="Nombre y Apellido Completo" autocomplete="off">
    <input type="tel" id="telefono" placeholder="N√∫mero de Cel√©fono (9xx...)" autocomplete="off">

    <div class="terminos-box">
        <b>REGLAS DEL IMPERIO:</b><br>
        1. <b>Cero Estafas:</b> Identidad verificada por sat√©lite obligatoria.<br>
        2. <b>Supervisi√≥n:</b> El administrador audita reportes de mal comportamiento.<br>
        3. <b>Comisiones:</b> Se acepta el pago de mantenimiento por ventas.<br>
        4. <b>Respeto:</b> Comportamiento profesional en todo momento.
    </div>

    <label class="check-group">
        <input type="checkbox" id="acepto">
        <span>Soy de la zona y acepto los t√©rminos de seguridad y comisiones del mercado.</span>
    </label>

    <button id="btnEntrar" onclick="validarYEntrar()" class="btn-ingresar">VERIFICAR E INGRESAR</button>
    <div id="status"></div>
</div>

<script>
async function validarYEntrar() {
    const nombre = document.getElementById('nombre').value.trim();
    const telefono = document.getElementById('telefono').value.trim();
    const acepto = document.getElementById('acepto').checked;
    const btn = document.getElementById('btnEntrar');
    const status = document.getElementById('status');

    if (!nombre || !telefono || !acepto) {
        alert("Completa tus datos y acepta las reglas para proteger el mercado.");
        return;
    }

    btn.disabled = true;
    status.style.color = "#2d6a4f";
    status.innerHTML = 'Buscando sat√©lite seguro<span class="loading-dot">.</span><span class="loading-dot" style="animation-delay: 0.2s">.</span><span class="loading-dot" style="animation-delay: 0.4s">.</span>';

    // CONFIGURACI√ìN DE ALTA SENSIBILIDAD
    const opcionesGPS = {
        enableHighAccuracy: true, 
        timeout: 15000,           // Espera 15 segundos antes de dar error
        maximumAge: 0             // No acepta ubicaciones viejas (fuerza lectura real)
    };

    navigator.geolocation.getCurrentPosition(
        async (pos) => {
            status.innerText = "¬°Ubicaci√≥n Verificada! Sincronizando...";

            const scriptURL = "https://script.google.com/macros/s/AKfycbwsQyjUIFJkUgKpYBQVM-sUccSRMBO1wZlr9m2cofzzFVsO_dpqVyjQzufMRmtNWVI7/exec";

            localStorage.setItem('rantiy_user', nombre);

            const datos = new FormData();
            datos.append('nombre', nombre);
            datos.append('telefono', telefono);
            datos.append('firma', "GPS Verificado ‚úÖ");
            datos.append('dispositivo', `Lat: ${pos.coords.latitude}, Lon: ${pos.coords.longitude}`);

            try {
                fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: datos });
                
                setTimeout(() => {
                    status.innerText = "Acceso Concedido. ¬°Bienvenido!";
                    window.location.href = "index.html"; 
                }, 1500);
            } catch (error) {
                window.location.href = "index.html";
            }
        },
        (err) => {
            btn.disabled = false;
            status.style.color = "#dc2626";
            
            if (err.code === 1) {
                status.innerText = "ERROR: Permiso denegado. Activa el GPS en el candado üîí arriba.";
            } else if (err.code === 3) {
                status.innerText = "ERROR: Tiempo agotado. Reintenta en un lugar abierto.";
            } else {
                status.innerText = "ERROR: No se pudo verificar tu ubicaci√≥n.";
            }
        },
        opcionesGPS
    );
}
</script>
</body>
</html>
